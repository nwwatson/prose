<%# locals: (post:) %>
<%= fields_for :post, post do |f| %>
  <div class="space-y-6 p-6">
    <div>
      <%= f.label :status, class: "block text-sm font-medium text-gray-900" %>
      <%= render "shared/custom_select", form: f, field: :status,
            options: Post.statuses.keys.map { |s| [s.capitalize, s] },
            form_attr: "post_form" %>
    </div>

    <div>
      <%= f.label :scheduled_at, class: "block text-sm font-medium text-gray-900" %>
      <div class="mt-2">
        <%= f.datetime_local_field :scheduled_at,
              form: "post_form",
              class: "block w-full rounded-md bg-white px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-gray-600 sm:text-sm" %>
      </div>
      <p class="mt-1 text-xs text-gray-500">Set when this post should be published.</p>
    </div>

    <div>
      <%= f.label :slug, class: "block text-sm font-medium text-gray-900" %>
      <div class="mt-2">
        <%= f.text_field :slug,
              form: "post_form",
              class: "block w-full rounded-md bg-white px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-600 sm:text-sm",
              placeholder: "auto-generated-from-title" %>
      </div>
      <p class="mt-1 text-xs text-gray-500">Leave blank to auto-generate from title.</p>
    </div>

    <div>
      <%= f.label :category_id, "Category", class: "block text-sm font-medium text-gray-900" %>
      <%= render "shared/custom_select", form: f, field: :category_id,
            collection: Category.ordered, value_method: :id, text_method: :name,
            include_blank: "No category",
            form_attr: "post_form" %>
    </div>

    <div>
      <%= f.label :tag_ids, "Tags", class: "block text-sm font-medium text-gray-900" %>
      <div class="mt-2">
        <input type="hidden" name="post[tag_ids][]" value="" form="post_form">
        <%= f.collection_check_boxes :tag_ids, Tag.all.order(:name), :id, :name do |b| %>
          <label class="flex items-center space-x-2 py-1">
            <%= b.check_box class: "rounded border-gray-300 text-gray-600 focus:ring-gray-600", form: "post_form" %>
            <span class="text-sm text-gray-700"><%= b.text %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="flex items-center">
      <%= f.check_box :featured, form: "post_form", class: "rounded border-gray-300 text-gray-600 focus:ring-gray-600" %>
      <%= f.label :featured, class: "ml-2 text-sm font-medium text-gray-900" %>
    </div>

    <div <% if SiteSetting.current.image_ai_configured? && post.persisted? %>
           data-controller="ai-image-modal"
           data-ai-image-modal-suggest-url-value="<%= suggest_prompt_admin_post_ai_featured_image_path(post) %>"
           data-ai-image-modal-generate-url-value="<%= admin_post_ai_featured_image_path(post) %>"
         <% end %>>
      <%= f.label :featured_image, class: "block text-sm font-medium text-gray-900" %>
      <div class="mt-2">
        <% if post.featured_image.attached? %>
          <div id="featured-image-preview" class="mb-3">
            <%= image_tag post.featured_image, class: "max-h-48 rounded-md" %>
          </div>
        <% end %>
        <%= f.file_field :featured_image, accept: "image/*", form: "post_form",
              class: "block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-gray-700 hover:file:bg-gray-200" %>
        <% if SiteSetting.current.image_ai_configured? && post.persisted? %>
          <p class="my-2 text-center text-xs text-gray-400">or</p>
          <button type="button"
                  data-action="click->ai-image-modal#open"
                  class="inline-flex items-center gap-1.5 rounded-md bg-purple-100 px-3 py-1.5 text-xs font-medium text-purple-700 hover:bg-purple-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            Generate with AI
          </button>
        <% end %>
      </div>
      <% if SiteSetting.current.image_ai_configured? && post.persisted? %>
        <%= render "admin/posts/featured_image_modal", post: post %>
      <% end %>
    </div>

    <div>
      <%= f.label :meta_description, "Meta description", class: "block text-sm font-medium text-gray-900" %>
      <div class="mt-2">
        <%= f.text_area :meta_description, rows: 3, maxlength: 160, form: "post_form",
              class: "block w-full rounded-md bg-white px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-600 sm:text-sm",
              placeholder: "Brief description for search engines (max 160 characters)" %>
      </div>
      <p class="mt-1 text-xs text-gray-500">Max 160 characters. Falls back to subtitle or content excerpt if blank.</p>
    </div>

    <% if post.persisted? %>
      <div class="border-t border-gray-200 pt-6">
        <%= button_to "Delete post", admin_post_path(post), method: :delete,
              data: { turbo_confirm: "Are you sure you want to delete this post?" },
              class: "w-full rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500" %>
      </div>
    <% end %>
  </div>
<% end %>
