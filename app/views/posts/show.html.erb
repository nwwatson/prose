<% content_for(:title, page_title(@post.title)) %>

<% content_for(:head) do %>
  <%= meta_tags_for_post(@post) %>
  <%= json_ld_for_post(@post) %>
<% end %>

<article>
  <header class="mb-8 border-b border-gray-300 pb-8">
    <h1 class="font-display text-4xl font-bold leading-tight lg:text-5xl"><%= @post.title %></h1>
    <% if @post.subtitle.present? %>
      <p class="mt-3 text-xl text-gray-600 font-subtitle"><%= @post.subtitle %></p>
    <% end %>
    <div class="mt-4 flex flex-wrap items-center gap-3 text-sm text-gray-500">
      <span>By <strong class="text-charcoal"><%= @post.user.display_name %></strong></span>
      <span>&middot;</span>
      <time datetime="<%= @post.published_at.iso8601 %>"><%= @post.published_at.strftime("%B %-d, %Y") %></time>
      <span>&middot;</span>
      <span><%= @post.reading_time_minutes %> min read</span>
      <% if @post.category %>
        <span>&middot;</span>
        <%= link_to @post.category.name, category_path(@post.category, slug: @post.category.slug), class: "text-ink-blue hover:underline" %>
      <% end %>
    </div>
  </header>

  <% if @post.featured_image.attached? %>
    <div class="mb-8">
      <%= image_tag @post.featured_image, class: "w-full rounded-lg", alt: @post.title %>
    </div>
  <% end %>

  <div class="prose prose-lg max-w-none prose-headings:font-display prose-a:text-ink-blue"
       data-controller="x-post-widget">
    <%= @post.content %>
  </div>

  <% if @post.tags.any? %>
    <footer class="mt-8 border-t border-gray-200 pt-6">
      <div class="flex flex-wrap gap-2">
        <% @post.tags.each do |post_tag| %>
          <%= link_to post_tag.name, tag_path(post_tag, slug: post_tag.slug),
                class: "inline-block rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 hover:bg-gray-200" %>
        <% end %>
      </div>
    </footer>
  <% end %>

  <%# Engagement %>
  <div class="mt-8 border-t border-gray-200 pt-6">
    <%= render "loves/button", post: @post %>
  </div>

  <%# Comments %>
  <div class="mt-8 border-t border-gray-200 pt-6">
    <h3 class="font-display text-xl font-bold">Comments</h3>

    <div id="comments" class="mt-4 divide-y divide-gray-100">
      <% @post.comments.approved.top_level.includes(:identity, replies: :identity).each do |comment| %>
        <%= render "comments/comment", comment: comment %>
        <% comment.replies.approved.each do |reply| %>
          <%= render "comments/comment", comment: reply %>
        <% end %>
      <% end %>
    </div>

    <div class="mt-6">
      <%= render "comments/form", post: @post %>
    </div>
  </div>
</article>
